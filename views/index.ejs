<!DOCTYPE html>
<html lang="en">

<head>
  <title>Home Page</title>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="stylesheet" href="/vendor/normalize-4.1.1.css" />
  <link rel="stylesheet" href="/vendor/border-box.css" />
  <link rel="stylesheet" href="/styles/main.css" />
  <link rel="stylesheet" href="/styles/layout.css" />
  <link rel="stylesheet" href="/styles/nav.css">
  <link rel="stylesheet" href="/styles/header.css">

  <!-- Font Awesome CDN -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

  <script src="/vendor/jquery-3.0.0.js"></script>
  <script defer src="/scripts/app.js"></script>
</head>

<body>
  <% console.log(`Displaying favourites!!!!`) %>
  <% console.log(favourites) %>
  <!-- Navbar pulled from partials/ directory -->
  <%- include('partials/_navbar') %>

  <header>
    <!-- Your header content here -->
  </header>

  <main>
    <section class="product-feed">
      <% movies.forEach(movie => { %>
        <%console.log(movie)%>
        <% if (movie.is_sold) { %>
        <div class="product-item-SOLD">
        <% } else { %>
          <div class="product-item">
          <% } %>

          <!-- Heart Icon Button -->
          <% const isFavourite = favourites.some(fav => fav.movie_id === movie.movie_id); %>
          <% if (isFavourite) { %>
            <form action="/favourites/<%= movie.movie_id %>/delete" method="POST" class="heart-icon-form">
              <input type="hidden" name="movie_id" value="<%= movie.movie_id %>">
              <button type="submit" class="heart-icon-button">
                <i class="fa fa-heart" aria-hidden="true"></i>
              </button>
            </form>
          <%} else {%>
          <form action="/favourites/<%= movie.movie_id %>" method="POST" class="heart-icon-form">
            <input type="hidden" name="movie_id" value="<%= movie.movie_id %>">
            <button type="submit" class="grey-heart-icon-button">
              <i class="fa fa-heart" aria-hidden="true"></i>
            </button>
          </form>
          <%} %>

          <h2><%= movie.title %>
          <% if (movie.is_sold) { %>
            <%= '- SOLD!' %>
            <% } %>
          </h2>

          <div class="movie-info">
            <p><%= movie.genre_name %></p>
            <p><%= movie.year %></p>
            <p>Rent now for: $<%= (movie.price / 100).toFixed(2) %></p>
            <p>Movie quality: <%= movie.quality %></p>
            <p class="rt_score">üçÖRT Score: <%= movie.rotten_tomatoes_score %></p>
          </div>

          <!-- Delete Movie Button -->
          <% if (cookie.userType === 'admin') { %>
          <form action="/movies/<%= movie.movie_id %>/delete" method="POST" style="display:inline">
            <button type="submit" id="delete_button">Delete</button>
          </form>
          <% } %>

          <!-- Mark Movie as Sold Button -->
          <% if (cookie.userType === 'admin' && !movie.is_sold) { %>
          <form action="/movies/<%= movie.movie_id %>" method="POST" style="display:inline">
            <button type="submit" id="sold_button">Mark as SOLD!</button>
          </form>
          <% } %>

        </div>
      <% }) %>
    </section>
  </main>

</body>

</html>
